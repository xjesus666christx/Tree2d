<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="jsoneditor/jsoneditor-min.css">
		<script type="text/javascript" src="jsoneditor/jsoneditor.js"></script>
		<script type="text/javascript" src="tree2d.js"></script>
	</head>
	<body>
		<div id="jsoneditor" style="min-width:400px;width:23%;height:650px;float:left">
		</div>
		<div class="jsoneditor" align="center" valign="center" style="min-width:880px;width:77%;height:650px;overflow:scroll;float:left" onselectstart="return false"  oncontextmenu="return false">
			<canvas id="treeeditor" width="960" height="640"></div>
		</div>
		<input type="button" value="RUN" onclick="this.value=tree.changeEditMode()?'RUN':'STOP'">
		<input type="button" value="LOG" onclick="console.log(tree.root)">
		<input type="button" value="JSON" onclick="tree.logJSON()">
		<input type="file" value="Load images" onchange="tree.loadImages(this.files)" multiple />
		
		<script type="text/javascript" >
			// create the editor
			
			var jsonContainer = document.getElementById("jsoneditor");
			var editor = new jsoneditor.JSONEditor(jsonContainer, {change:setTree});
			
			// set json
			var json = JSON.parse('{"w":960,"h":640,"n":1,"menu":{"bg0":{"w":960,"h":640,"init":"sprite","src":"#111122"},"logo":{"x":252,"y":-227,"r":7,"w":300,"h":100,"init":"sprite","src":"#aaf022"},"playBtn":{"w":200,"h":150,"init":"sprite","click":"reset(_level%n); _level%n.a=1","src":"#bc7722"},"soundBtn":{"x":-422,"y":-251,"w":70,"h":70,"init":"sprite","src":"#bc7722"}},"level1":{"w":960,"h":640,"g":0.3,"a":0,"bg1":{"click":"_player%n.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"death":{"player-clone":{"w":25,"h":25,"update":"x=_player%n.x; y=_player%n.y","boxCollision":"_level%n.a=0","x":-720,"y":993},"n1":{"y":235,"w":70,"h":35,"src":"danger","init":"link"},"n2":{"x":140,"y":-44,"w":70,"h":35,"src":"danger","init":"link"},"n3":{"x":-210,"y":-46,"w":70,"h":35,"src":"danger","init":"link"}},"blocks":{"n12":{"x":-420,"y":280,"w":70,"h":70,"src":"block","init":"link"},"portal":{"x":491,"y":210,"w":68,"h":500,"boxCollision":"_player%n.x=_portal%n.x; _player%n.y=_portal%n.y; _player%n.sx=-_player%n.sx"},"portal1":{"x":420,"y":-70},"player1":{"x":-723,"y":1019,"w":35,"h":35,"sx":3,"sy":0,"src":"player","jumpSpeed":7,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=_level%n.g; y+=sy; x+=sx; needJump=0; _level%n.a=y>1000?0:_level%n.a","init":"x=_spawn%n.x; y=_spawn%n.y; link"},"n1512":{"x":-350,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1513":{"x":-280,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1514":{"x":-210,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1515":{"x":-140,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1516":{"x":-70,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1517":{"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1518":{"x":70,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1519":{"x":140,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1520":{"x":210,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1521":{"x":280,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1522":{"x":350,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1523":{"x":420,"y":280,"w":70,"h":70,"src":"block","init":"link"},"n1524":{"x":420,"w":70,"h":70,"src":"block","init":"link"},"n1525":{"x":350,"w":70,"h":70,"src":"block","init":"link"},"n1526":{"x":280,"w":70,"h":70,"src":"block","init":"link"},"n1527":{"x":210,"w":70,"h":70,"src":"block","init":"link"},"n1528":{"x":140,"w":70,"h":70,"src":"block","init":"link"},"n1529":{"x":70,"w":70,"h":70,"src":"block","init":"link"},"n1530":{"w":70,"h":70,"src":"block","init":"link"},"n1531":{"x":-70,"w":70,"h":70,"src":"block","init":"link"},"n1532":{"x":-140,"w":70,"h":70,"src":"block","init":"link"},"n1533":{"x":-210,"w":70,"h":70,"src":"block","init":"link"},"n1534":{"x":-280,"w":70,"h":70,"src":"block","init":"link"},"n1535":{"x":-350,"w":70,"h":70,"src":"block","init":"link"},"n1536":{"x":-420,"w":70,"h":70,"src":"block","init":"link"},"n1537":{"x":210,"y":210,"w":70,"h":70,"src":"block","init":"link"}},"spawn1":{"x":-420,"y":140}},"sprites":{"a":0,"init":"sprite","h":1000,"w":1000,"src":"#333","player":{"img":{"init":"sprite","h":35,"w":35,"src":"#00ff00"}},"block":{"img":{"init":"sprite","h":70,"w":70,"src":"#bc7722"}},"danger":{"img":{"init":"sprite","h":35,"w":70,"src":"#f00"}}}}');
			editor.set(json);
			
			function selectNode(name) {
				tree.highlight(tree.findByName(name));
			}
			
			var treeContainer = document.getElementById("treeeditor");
			var tree = new Tree2d(treeContainer, editor.get());
			tree.changeEditMode('on');
			tree.onchange = function(json) {
				editor.set(json);
			}
			tree.onselect = function(name) {
				editor.selectNode(name);
			}
			
			function setTree() {
				tree.set(editor.get());
			}
			</script>
	</body>
</html>