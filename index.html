<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="jsoneditor/jsoneditor-min.css">
		<script type="text/javascript" src="jsoneditor/jsoneditor.js"></script>
		<script type="text/javascript" src="tree2d.js"></script>
	</head>
	<body>
		<div id="jsoneditor" style="min-width:400px;width:23%;height:650px;float:left">
		</div>
		<div class="jsoneditor" align="center" valign="center" style="min-width:960px;width:77%;height:650px;overflow:scroll;float:left" onselectstart="return false"  oncontextmenu="return false">
			<canvas id="treeeditor" width="960" height="640"></canvas>
		</div>
		<input type="button" value="RUN" onclick="this.value=tree.changeEditMode()?'RUN':'STOP'">
		<input type="button" value="LOG" onclick="console.log(tree.root)">
		<input type="button" value="JSON" onclick="tree.logJSON()">
		<input type="file" value="Load images" onchange="tree.loadImages(this.files)" multiple />
		
		<script type="text/javascript" >
			// create the editor
			
			var jsonContainer = document.getElementById("jsoneditor");
			var editor = new jsoneditor.JSONEditor(jsonContainer, {change:setTree});
			
			// set json
			var json = JSON.parse('{"w":960,"h":640,"n":1,"maxLvl":2,"sprites":{"init":"sprite","h":1000,"w":1000,"src":"#333","playerGfx":{"p":0,"img":{"init":"sprite","h":50,"w":50,"src":"#00ff00"}},"blockGfx":{"p":0,"img":{"init":"sprite","h":100,"w":100,"src":"#bc7722"}},"dangerGfx":{"p":0,"img":{"init":"sprite","h":35,"w":100,"src":"#f00"}}},"lvlSelector":{"init":"sprite","w":960,"h":640,"src":"#111122","lvls":{"dx":0,"update":"x+=(dx-x)*0.1","lvlIcon1":{"w":750,"h":550,"init":"sprite","src":"#1d1"},"lvlIcon2":{"x":960,"w":750,"h":550,"init":"sprite","src":"#11d"}},"playBtn":{"w":700,"h":500,"a":0.2,"init":"sprite","click":"reset(level#n); level#n.a=1; pause.a=1","src":"#bc7722"},"nextLvl":{"w":100,"h":300,"init":"sprite","click":"lvls.dx-=960; root.n++; prevLvl.a=1","update":"a=root.n<root.maxLvl?1:0","src":"#bc7722","x":431},"prevLvl":{"w":100,"h":300,"init":"sprite","click":"lvls.dx+=960; root.n--; nextLvl.a=1","update":"a=root.n>1?1:0","src":"#bc7722","x":-430}},"level1":{"w":960,"h":640,"g":0.25,"a":0,"bg":{"click":"player.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"gamefield":{"y":1,"dy":0,"update":"y+=(dy-y)*0.1","active":{"p":0,"playerClone":{"w":35,"h":35,"update":"x=player.x; y=player.y","x":-618,"y":111},"portal0":{"x":621,"y":170,"w":35,"h":35,"boxCollision":"player.y-=280; player.sx=-player.sx"},"portal1":{"x":-618,"y":-131,"w":35,"h":35,"boxCollision":"player.y-=280; player.sx=-player.sx; gamefield.dy+=600"},"spikes0":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":100},"spikes1":{"y":205,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1"},"spikes3":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":300},"spikes4":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":-100},"spikes5":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":-300}},"physics":{"p":0,"player":{"x":-600,"y":185,"w":50,"h":50,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":8,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=level#n.g; y+=sy; x+=sx; needJump=0; level#n.a=y>1000?0:level#n.a","init":"link"},"n0":{"x":-600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n1":{"x":-500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n2":{"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n3":{"x":-100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n4":{"x":-200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n5":{"x":-300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n6":{"x":-400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n7":{"x":100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n8":{"x":200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n9":{"x":300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n10":{"x":400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n11":{"x":500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n12":{"x":600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n13":{"x":700,"y":160,"w":100,"h":100,"src":"blockGfx","init":"link"},"n14":{"x":700,"y":60,"w":100,"h":100,"src":"blockGfx","init":"link"},"n15":{"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n16":{"x":100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n17":{"x":200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n18":{"x":300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n19":{"x":400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n20":{"x":500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n21":{"x":600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n22":{"x":-100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n23":{"x":-200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n24":{"x":-300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n25":{"x":-400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n26":{"x":-500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n27":{"x":-600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n28":{"x":-700,"y":-140,"w":100,"h":100,"src":"blockGfx","init":"link"},"n29":{"x":-700,"y":-240,"w":100,"h":100,"src":"blockGfx","init":"link"},"n30":{"x":-600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n31":{"x":-500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n32":{"x":-400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n33":{"x":-300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n34":{"x":-200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n35":{"x":-100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n36":{"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n37":{"x":100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n38":{"x":200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n39":{"x":300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n40":{"x":400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n41":{"x":500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n42":{"x":600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"}}}},"level2":{"w":960,"h":640,"g":0.25,"a":0,"bg":{"click":"player.needJump=1","w":960,"h":640,"init":"sprite","src":"#664411"},"gamefield":{"y":1,"dy":0,"update":"y+=(dy-y)*0.1","active":{"p":0,"playerClone":{"w":35,"h":35,"update":"x=player.x; y=player.y","x":-618,"y":111},"portal0":{"x":621,"y":170,"w":35,"h":35,"boxCollision":"player.y-=280; player.sx=-player.sx"},"portal1":{"x":-618,"y":-131,"w":35,"h":35,"boxCollision":"player.y-=280; player.sx=-player.sx; gamefield.dy+=600"},"spikes0":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":100},"spikes1":{"y":205,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1"},"spikes3":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":300},"spikes4":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":-100},"spikes5":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"fail.a=1; level#n.p=1","x":-300}},"physics":{"p":0,"player":{"x":-600,"y":185,"w":50,"h":50,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":8,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=level#n.g; y+=sy; x+=sx; needJump=0; level#n.a=y>1000?0:level#n.a","init":"link"},"n0":{"x":-600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n1":{"x":-500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n2":{"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n3":{"x":-100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n4":{"x":-200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n5":{"x":-300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n6":{"x":-400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n7":{"x":100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n8":{"x":200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n9":{"x":300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n10":{"x":400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n11":{"x":500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n12":{"x":600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n13":{"x":700,"y":160,"w":100,"h":100,"src":"blockGfx","init":"link"},"n14":{"x":700,"y":60,"w":100,"h":100,"src":"blockGfx","init":"link"},"n15":{"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n16":{"x":100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n17":{"x":200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n18":{"x":300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n19":{"x":400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n20":{"x":500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n21":{"x":600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n22":{"x":-100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n23":{"x":-200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n24":{"x":-300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n25":{"x":-400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n26":{"x":-500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n27":{"x":-600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n28":{"x":-700,"y":-140,"w":100,"h":100,"src":"blockGfx","init":"link"},"n29":{"x":-700,"y":-240,"w":100,"h":100,"src":"blockGfx","init":"link"},"n30":{"x":-600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n31":{"x":-500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n32":{"x":-400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n33":{"x":-300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n34":{"x":-200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n35":{"x":-100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n36":{"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n37":{"x":100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n38":{"x":200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n39":{"x":300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n40":{"x":400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n41":{"x":500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n42":{"x":600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"}}}},"fail":{"init":"sprite","update":"pause.a=0","a":0,"h":320,"w":480,"src":"#333","gfx":{"init":"sprite","h":100,"w":25,"src":"#f00","y":-50,"x":-134},"gfx0":{"init":"sprite","h":25,"w":25,"src":"#f00","x":-134,"y":33},"gfx1":{"init":"sprite","h":100,"w":200,"src":"#f00","y":-29},"failOkBtn":{"init":"sprite","h":50,"w":100,"src":"#00ff00","y":99,"click":"level#n.a=0; fail.a=0; pause.a=0;"}},"pause":{"a":0,"btn":{"init":"sprite","h":50,"w":100,"src":"#00ff00","y":-270,"click":"level#n.p=!level#n.p; pauseIcon.p=level#n.p","x":388},"pauseIcon":{"p":0,"gfx12":{"init":"sprite","h":30,"w":5,"src":"#f00","y":-268,"x":360},"gfx13":{"init":"sprite","h":30,"w":5,"src":"#f00","y":-268,"x":350}}}}');
			editor.set(json);
			
			function selectNode(name) {
				tree.highlight(tree.findByName(name));
			}
			
			var treeContainer = document.getElementById("treeeditor");
			var tree = new Tree2d(treeContainer, editor.get());
			tree.changeEditMode('on');
			tree.onchange = function(json) {
				editor.set(json);
			}
			tree.onselect = function(name) {
				editor.selectNode(name);
			}
			
			function setTree() {
				tree.set(editor.get());
			}
			</script>
	</body>
</html>