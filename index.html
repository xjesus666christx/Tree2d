<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="jsoneditor/jsoneditor-min.css">
		<script type="text/javascript" src="jsoneditor/jsoneditor.js"></script>
		<script type="text/javascript" src="tree2d.js"></script>
	</head>
	<body>
		<div id="jsoneditor" style="min-width:400px;width:23%;height:650px;float:left">
		</div>
		<div class="jsoneditor" align="center" valign="center" style="min-width:880px;width:77%;height:650px;overflow:scroll;float:left" onselectstart="return false"  oncontextmenu="return false">
			<canvas id="treeeditor" width="960" height="640"></div>
		</div>
		<input type="button" value="RUN" onclick="this.value=tree.changeEditMode()?'RUN':'STOP'">
		<input type="button" value="LOG" onclick="console.log(tree.root)">
		<input type="button" value="JSON" onclick="tree.logJSON()">
		<input type="file" value="Load images" onchange="tree.loadImages(this.files)" multiple />
		
		<script type="text/javascript" >
			// create the editor
			
			var jsonContainer = document.getElementById("jsoneditor");
			var editor = new jsoneditor.JSONEditor(jsonContainer, {change:setTree});
			
			// set json
			var json = JSON.parse('{"w":960,"h":640,"n":2,"menu":{"bg0":{"w":960,"h":640,"init":"sprite","src":"#111122"},"logo":{"x":252,"y":-227,"r":7,"w":300,"h":100,"init":"sprite","src":"#aaf022"},"playBtn":{"w":200,"h":150,"init":"sprite","click":"reset(_level%n); _level%n.a=1","src":"#bc7722"},"soundBtn":{"x":-422,"y":-251,"w":70,"h":70,"init":"sprite","src":"#bc7722"}},"level1":{"w":960,"h":640,"g":0.3,"a":0,"bg":{"click":"_player.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"gamefield":{"active":{"playerClone":{"w":25,"h":25,"update":"x=_player.x; y=_player.y"},"portal":{"x":491,"y":210,"w":68,"h":500,"boxCollision":"_player.x=_portal1.x; _player.y=_portal1.y; _player.sx=-_player.sx"},"portal1":{"x":420,"y":-70},"spikes1":{"y":235,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level%n.a=0"}},"physics":{"player":{"x":-420,"y":140,"w":35,"h":35,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":7,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=_level%n.g; y+=sy; x+=sx; needJump=0; _level%n.a=y>1000?0:_level%n.a","init":"link"},"n12":{"x":-420,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n815":{"x":-350,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n816":{"x":-280,"y":210,"w":70,"h":70,"src":"blockGfx","init":"link"},"n898":{"x":-280,"y":-207,"w":70,"h":70,"src":"blockGfx","init":"link"},"n899":{"x":-280,"y":-137,"w":70,"h":70,"src":"blockGfx","init":"link"},"n900":{"x":-280,"y":-67,"w":70,"h":70,"src":"blockGfx","init":"link"}}}},"level2":{"w":960,"h":640,"g":0.3,"a":0,"bg":{"click":"_player.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"gamefield":{"active":{"playerClone":{"w":25,"h":25,"update":"x=_player.x; y=_player.y"},"portal":{"x":491,"y":210,"w":68,"h":500,"boxCollision":"_player.x=_portal1.x; _player.y=_portal1.y; _player.sx=-_player.sx"},"portal1":{"x":420,"y":-70},"spikes1":{"y":235,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level%n.a=0"}},"physics":{"player":{"x":-420,"y":140,"w":35,"h":35,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":7,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=_level%n.g; y+=sy; x+=sx; needJump=0; _level%n.a=y>1000?0:_level%n.a","init":"link"},"n12":{"x":-420,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n546":{"x":-350,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n547":{"x":-280,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n548":{"x":-210,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1030":{"x":-140,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1031":{"x":-70,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1032":{"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1033":{"x":70,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1034":{"x":140,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1035":{"x":140,"y":210,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1036":{"x":-280,"y":-211,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1037":{"x":-210,"y":-141,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1038":{"x":-280,"y":-71,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1039":{"x":-210,"y":-1,"w":70,"h":70,"src":"blockGfx","init":"link"},"n1040":{"x":-280,"y":-1,"w":70,"h":70,"src":"blockGfx","init":"link"}}}},"sprites":{"a":0,"init":"sprite","h":1000,"w":1000,"src":"#333","playerGfx":{"img":{"init":"sprite","h":35,"w":35,"src":"#00ff00"}},"blockGfx":{"img":{"init":"sprite","h":70,"w":70,"src":"#bc7722"}},"dangerGfx":{"img":{"init":"sprite","h":35,"w":70,"src":"#f00"}}}}');
			editor.set(json);
			
			function selectNode(name) {
				tree.highlight(tree.findByName(name));
			}
			
			var treeContainer = document.getElementById("treeeditor");
			var tree = new Tree2d(treeContainer, editor.get());
			tree.changeEditMode('on');
			tree.onchange = function(json) {
				editor.set(json);
			}
			tree.onselect = function(name) {
				editor.selectNode(name);
			}
			
			function setTree() {
				tree.set(editor.get());
			}
			</script>
	</body>
</html>