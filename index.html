<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="jsoneditor/jsoneditor-min.css">
		<script type="text/javascript" src="jsoneditor/jsoneditor.js"></script>
		<script type="text/javascript" src="tree2d.js"></script>
	</head>
	<body>
		<div id="jsoneditor" style="min-width:400px;width:23%;height:650px;float:left">
		</div>
		<div class="jsoneditor" align="center" valign="center" style="min-width:960px;width:77%;height:650px;overflow:scroll;float:left" onselectstart="return false"  oncontextmenu="return false">
			<canvas id="treeeditor" width="960" height="640"></canvas>
		</div>
		<input type="button" value="RUN" onclick="this.value=tree.changeEditMode()?'RUN':'STOP'">
		<input type="button" value="LOG" onclick="console.log(tree.root)">
		<input type="button" value="JSON" onclick="tree.logJSON()">
		<input type="file" value="Load images" onchange="tree.loadImages(this.files)" multiple />
		
		<script type="text/javascript" >
			// create the editor
			
			var jsonContainer = document.getElementById("jsoneditor");
			var editor = new jsoneditor.JSONEditor(jsonContainer, {change:setTree});
			
			// set json
			var json = JSON.parse('{"w":1400,"h":640,"n":1,"sprites":{"init":"sprite","h":1000,"w":1000,"src":"#333","playerGfx":{"img":{"init":"sprite","h":50,"w":50,"src":"#00ff00"}},"blockGfx":{"img":{"init":"sprite","h":100,"w":100,"src":"#bc7722"}},"dangerGfx":{"img":{"init":"sprite","h":35,"w":100,"src":"#f00"}}},"menu":{"bg0":{"w":960,"h":640,"init":"sprite","src":"#111122"},"logo":{"x":252,"y":-227,"r":7,"w":300,"h":100,"init":"sprite","src":"#aaf022"},"playBtn":{"w":200,"h":150,"init":"sprite","click":"reset(_level#n); _level#n.a=1","src":"#bc7722"},"soundBtn":{"x":-422,"y":-251,"w":70,"h":70,"init":"sprite","src":"#bc7722"}},"level1":{"w":960,"h":640,"g":0.25,"a":0.99,"bg":{"click":"_player.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"gamefield":{"y":1,"dy":0,"update":"y+=(dy-y)*0.1","active":{"playerClone":{"w":35,"h":35,"update":"x=_player.x; y=_player.y","x":-618,"y":111},"spikes1":{"y":205,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0"},"portal0":{"x":621,"y":170,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx"},"portal1":{"x":-618,"y":-131,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx; _gamefield.dy+=600"},"spikes0":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":100},"spikes3":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":300},"spikes4":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-100},"spikes5":{"y":-96,"w":100,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-300}},"physics":{"player":{"x":-600,"y":185,"w":50,"h":50,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":8,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=_level#n.g; y+=sy; x+=sx; needJump=0; _level#n.a=y>1000?0:_level#n.a","init":"link"},"n0":{"x":-600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n1":{"x":-500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n2":{"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n3":{"x":-100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n4":{"x":-200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n5":{"x":-300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n6":{"x":-400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n7":{"x":100,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n8":{"x":200,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n9":{"x":300,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n10":{"x":400,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n11":{"x":500,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n12":{"x":600,"y":260,"w":100,"h":100,"src":"blockGfx","init":"link"},"n13":{"x":700,"y":160,"w":100,"h":100,"src":"blockGfx","init":"link"},"n14":{"x":700,"y":60,"w":100,"h":100,"src":"blockGfx","init":"link"},"n15":{"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n16":{"x":100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n17":{"x":200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n18":{"x":300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n19":{"x":400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n20":{"x":500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n21":{"x":600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n22":{"x":-100,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n23":{"x":-200,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n24":{"x":-300,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n25":{"x":-400,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n26":{"x":-500,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n27":{"x":-600,"y":-40,"w":100,"h":100,"src":"blockGfx","init":"link"},"n28":{"x":-700,"y":-140,"w":100,"h":100,"src":"blockGfx","init":"link"},"n29":{"x":-700,"y":-240,"w":100,"h":100,"src":"blockGfx","init":"link"},"n30":{"x":-600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n31":{"x":-500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n32":{"x":-400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n33":{"x":-300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n34":{"x":-200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n35":{"x":-100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n36":{"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n37":{"x":100,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n38":{"x":200,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n39":{"x":300,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n40":{"x":400,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n41":{"x":500,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"},"n42":{"x":600,"y":-340,"w":100,"h":100,"src":"blockGfx","init":"link"}}}}}');
			editor.set(json);
			
			function selectNode(name) {
				tree.highlight(tree.findByName(name));
			}
			
			var treeContainer = document.getElementById("treeeditor");
			var tree = new Tree2d(treeContainer, editor.get());
			tree.changeEditMode('on');
			tree.onchange = function(json) {
				editor.set(json);
			}
			tree.onselect = function(name) {
				editor.selectNode(name);
			}
			
			function setTree() {
				tree.set(editor.get());
			}
			</script>
	</body>
</html>