<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="jsoneditor/jsoneditor-min.css">
		<script type="text/javascript" src="jsoneditor/jsoneditor.js"></script>
		<script type="text/javascript" src="tree2d.js"></script>
	</head>
	<body>
		<div id="jsoneditor" style="min-width:400px;width:23%;height:650px;float:left">
		</div>
		<div class="jsoneditor" align="center" valign="center" style="min-width:960px;width:77%;height:650px;overflow:scroll;float:left" onselectstart="return false"  oncontextmenu="return false">
			<canvas id="treeeditor" width="960" height="640"></canvas>
		</div>
		<input type="button" value="RUN" onclick="this.value=tree.changeEditMode()?'RUN':'STOP'">
		<input type="button" value="LOG" onclick="console.log(tree.root)">
		<input type="button" value="JSON" onclick="tree.logJSON()">
		<input type="file" value="Load images" onchange="tree.loadImages(this.files)" multiple />
		
		<script type="text/javascript" >
			// create the editor
			
			var jsonContainer = document.getElementById("jsoneditor");
			var editor = new jsoneditor.JSONEditor(jsonContainer, {change:setTree});
			
			// set json
			var json = JSON.parse('{"w":960,"h":640,"n":1,"sprites":{"init":"sprite","h":1000,"w":1000,"src":"#333","playerGfx":{"img":{"init":"sprite","h":35,"w":35,"src":"#00ff00"}},"blockGfx":{"img":{"init":"sprite","h":70,"w":70,"src":"#bc7722"}},"dangerGfx":{"img":{"init":"sprite","h":35,"w":70,"src":"#f00"}}},"menu":{"bg0":{"w":960,"h":640,"init":"sprite","src":"#111122"},"logo":{"x":252,"y":-227,"r":7,"w":300,"h":100,"init":"sprite","src":"#aaf022"},"playBtn":{"w":200,"h":150,"init":"sprite","click":"reset(_level#n); _level#n.a=1","src":"#bc7722"},"soundBtn":{"x":-422,"y":-251,"w":70,"h":70,"init":"sprite","src":"#bc7722"}},"level1":{"w":960,"h":640,"g":0.3,"a":0,"bg":{"click":"_player.needJump=1","w":960,"h":640,"init":"sprite","src":"#444466"},"gamefield":{"y":1310,"dy":0,"update":"y+=(dy-y)*0.1","active":{"playerClone":{"w":25,"h":25,"update":"x=_player.x; y=_player.y"},"spikes1":{"y":-29,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0"},"spikes3":{"y":-315,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":70},"spikes4":{"y":-315,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-70},"portal0":{"x":564,"y":223,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx"},"portal1":{"x":-632,"y":-64,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx; _gamefield.dy+=560"},"portal2":{"x":632,"y":-350,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx"},"portal3":{"x":-632,"y":-624,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx; _gamefield.dy+=560"},"portal4":{"x":632,"y":-902,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx"},"portal5":{"x":-632,"y":-1183,"w":35,"h":35,"boxCollision":"_player.y-=280; _player.sx=-_player.sx; _gamefield.dy+=560"},"spikes5":{"y":-589,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-210},"spikes0":{"y":-867,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-210},"spikes2":{"y":-867,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-350},"spikes6":{"y":-867,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-70},"spikes7":{"y":-867,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":70},"spikes8":{"y":-867,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":208},"spikes9":{"y":-1148,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":138},"spikes10":{"y":-1370,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":70},"spikes11":{"y":-1148,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0"},"spikes12":{"y":-1148,"w":70,"h":35,"src":"dangerGfx","init":"link","boxCollision":"_level#n.a=0","x":-140}},"physics":{"player":{"x":-630,"y":210,"w":35,"h":35,"sx":3,"sy":0,"src":"playerGfx","jumpSpeed":7,"needJump":0,"boxCollision":"sy=0; sy-=needJump*jumpSpeed","update":"sy+=_level#n.g; y+=sy; x+=sx; needJump=0; _level#n.a=y>1000?0:_level#n.a","init":"link"},"n1":{"x":-420,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n2":{"x":-350,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n3":{"x":-280,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n4":{"x":-490,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n5":{"x":-210,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n6":{"x":-140,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n7":{"x":-70,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n8":{"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n9":{"x":70,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n10":{"x":140,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n11":{"x":210,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n12":{"x":280,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n13":{"x":350,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n14":{"x":420,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n15":{"x":490,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n16":{"x":490,"w":70,"h":70,"src":"blockGfx","init":"link"},"n17":{"x":420,"w":70,"h":70,"src":"blockGfx","init":"link"},"n18":{"x":350,"w":70,"h":70,"src":"blockGfx","init":"link"},"n19":{"x":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n20":{"x":210,"w":70,"h":70,"src":"blockGfx","init":"link"},"n21":{"x":140,"w":70,"h":70,"src":"blockGfx","init":"link"},"n22":{"w":70,"h":70,"src":"blockGfx","init":"link"},"n23":{"x":70,"w":70,"h":70,"src":"blockGfx","init":"link"},"n24":{"x":-70,"w":70,"h":70,"src":"blockGfx","init":"link"},"n25":{"x":-140,"w":70,"h":70,"src":"blockGfx","init":"link"},"n26":{"x":-210,"w":70,"h":70,"src":"blockGfx","init":"link"},"n27":{"x":-280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n28":{"x":-350,"w":70,"h":70,"src":"blockGfx","init":"link"},"n29":{"x":-420,"w":70,"h":70,"src":"blockGfx","init":"link"},"n30":{"x":-490,"w":70,"h":70,"src":"blockGfx","init":"link"},"n31":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280},"n32":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":70},"n33":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":210},"n34":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":280},"n35":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":350},"n36":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":420},"n37":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":490},"n38":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-70},"n39":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-140},"n40":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-210},"n41":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-280},"n42":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-350},"n43":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-420},"n44":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-490},"n45":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":140},"n46":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-350},"n47":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-420},"n48":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-490},"n49":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-280},"n50":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-210},"n51":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-140},"n52":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-70},"n53":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560},"n54":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":70},"n55":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":140},"n56":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":210},"n57":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":280},"n58":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":350},"n59":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":420},"n60":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-490,"x":700},"n61":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":490},"n62":{"x":560,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n63":{"x":630,"y":210,"w":70,"h":70,"src":"blockGfx","init":"link"},"n64":{"x":630,"y":140,"w":70,"h":70,"src":"blockGfx","init":"link"},"n65":{"x":-700,"w":70,"h":70,"src":"blockGfx","init":"link","y":-70},"n66":{"x":-700,"w":70,"h":70,"src":"blockGfx","init":"link","y":-140},"n67":{"x":-700,"w":70,"h":70,"src":"blockGfx","init":"link","y":-210},"n68":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-350,"x":700},"n69":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":560},"n70":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-420,"x":700},"n71":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-630,"x":-700},"n72":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-700,"x":-700},"n73":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-770,"x":-700},"n74":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-490},"n75":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-420},"n76":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-350},"n77":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-280},"n78":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-210},"n79":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-140},"n80":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-70},"n81":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840},"n82":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":70},"n83":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":140},"n84":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":210},"n85":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":280},"n86":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":350},"n87":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":420},"n88":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":280},"n89":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":490},"n90":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-910,"x":700},"n91":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-980,"x":700},"n92":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1050,"x":700},"n93":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":490},"n94":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":420},"n95":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":350},"n96":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":210},"n97":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":140},"n98":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":70},"n99":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120},"n100":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-70},"n101":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-140},"n102":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-210},"n103":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-280},"n104":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-350},"n105":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-420},"n106":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-490},"n107":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1190,"x":-700},"n108":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":-700},"n109":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1330,"x":-700},"n110":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-490},"n111":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-420},"n112":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-350},"n113":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-280},"n114":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-210},"n115":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-140},"n116":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-70},"n117":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400},"n118":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":70},"n119":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":140},"n120":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":210},"n121":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":280},"n122":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":350},"n123":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":420},"n124":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":490},"n0":{"x":-560,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n125":{"x":630,"y":70,"w":70,"h":70,"src":"blockGfx","init":"link"},"n126":{"x":560,"w":70,"h":70,"src":"blockGfx","init":"link"},"n127":{"x":-560,"w":70,"h":70,"src":"blockGfx","init":"link"},"n128":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-560},"n129":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":560},"n130":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":630},"n131":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":630},"n132":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-560},"n133":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-560},"n134":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":560},"n135":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":630},"n136":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":630},"n137":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":560},"n138":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-560},"n139":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-560},"n140":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1400,"x":-630},"n141":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1120,"x":-630},"n142":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-560,"x":-630},"n143":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-840,"x":-630},"n144":{"x":-630,"w":70,"h":70,"src":"blockGfx","init":"link"},"n145":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-280,"x":-630},"n146":{"x":-630,"y":280,"w":70,"h":70,"src":"blockGfx","init":"link"},"n147":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-630},"n148":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-630,"x":70},"n149":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-910,"x":-140},"n150":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-910,"x":350},"n151":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-980,"x":350},"n152":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1190,"x":350},"n153":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":140},"n154":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":70},"n155":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":210},"n156":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260},"n157":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":-70},"n158":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1190,"x":-280},"n159":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1330,"x":-420},"n160":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1260,"x":-420},"n161":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1470,"x":420},"n162":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1540,"x":420},"n163":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1610,"x":280},"n164":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1610,"x":350},"n165":{"w":70,"h":70,"src":"blockGfx","init":"link","y":-1540,"x":350}}}}}');
			editor.set(json);
			
			function selectNode(name) {
				tree.highlight(tree.findByName(name));
			}
			
			var treeContainer = document.getElementById("treeeditor");
			var tree = new Tree2d(treeContainer, editor.get());
			tree.changeEditMode('on');
			tree.onchange = function(json) {
				editor.set(json);
			}
			tree.onselect = function(name) {
				editor.selectNode(name);
			}
			
			function setTree() {
				tree.set(editor.get());
			}
			</script>
	</body>
</html>